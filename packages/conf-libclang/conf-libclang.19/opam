opam-version: "2.0"
maintainer: "Thierry Martinez <martinez@nsup.org>"
authors: "The LLVM team"
homepage: "http://llvm.org"
bug-reports: "https://llvm.org/bugs/"
license: "MIT"
build-env: [
  [HOMEBREW_NO_AUTO_UPDATE = "1"]
]
build: [
  ["bash" "-ex" "configure.sh" version] # pass pkg var '19' to test <= 19.0.x
]
depends: [
  "conf-bash" {build}
]
depexts: [
  ["llvm@19"] {os-distribution = "homebrew" & os = "macos"}
  ["llvm-19"] {os-distribution = "macports" & os = "macos"}
  ["llvm19" "clang19"] {os-distribution = "arch"}
  # Ubuntu
  ["libclang-19-dev" "libclang-cpp19-dev" "llvm-19-dev" "clang-19"]         {os-distribution = "ubuntu" & os-version >= "24.04" }
  ["libclang-dev" "libclang-cpp-dev" "llvm-dev" "clang" ]         {os-distribution = "ubuntu" & os-version > "22.10" & os-version < "24.04"}
  ["libclang-15-dev" "libclang-cpp15-dev" "llvm-15-dev" "clang-15" ] {os-distribution = "ubuntu" & os-version = "22.10"}
  ["libclang-14-dev" "libclang-cpp14-dev" "llvm-14-dev" "clang-14" ] {os-distribution = "ubuntu" & os-version = "22.04"}
  # Debian
  ["libclang-19-dev" "libclang-cpp19-dev" "llvm-19-dev" "clang-19"]         {os-distribution = "debian" & os-version >= "12"}
  ["libclang-dev" "libclang-cpp-dev" "llvm-dev" "clang"]         {os-distribution = "debian" & os-version = "11"}
  # Derivatives or older versions
  ["libclang-19-dev" "llvm-19-dev" "clang-19"] {
     (os-family = "debian" | os-family = "ubuntu") &
     !(os-distribution = "debian" & os-version >= "11") &
      !(os-distribution = "ubuntu" & os-version >= "22.04")}
  # Alpine
  ["clang19-dev" "llvm19-dev" "clang19-static" "llvm19-static" "llvm19-gtest" "clang19-extra-tools" ] {os-distribution = "alpine" & os-version >= "3.21"}
  ["clang-dev" "llvm-dev" "clang-static" "llvm-static" "llvm-gtest" "clang-extra-tools" ] {os-distribution = "alpine" & os-version < "3.21"}
  ["clang-devel" "llvm-devel" "zlib-devel" "llvm-static"] {os-distribution = "centos"}
  ["clang-devel" "llvm-devel" "zlib-devel" "redhat-rpm-config"] {os-family = "fedora"}
  ["clang-devel" "llvm-devel" "zlib-devel" "llvm-static"] {os-distribution = "ol" & os-version >= "8"}
  ["clang-devel" "llvm-devel" "zlib-devel"] {os-family = "suse"}
  ["clang-devel" "llvm-devel" "zlib-ng-compat-devel"] {os-family = "opensuse"}
  ["devel/llvm19"] {os = "freebsd"}
  ["sys-devel/clang"] {os-distribution = "gentoo"}
]
x-ci-accept-failures: [
  "oraclelinux-7" # clang-devel is not available
  "alpine-3.13" # unavailable system package 'llvm-dev'
  "alpine-3.14" # unavailable system package 'llvm-dev'
  "alpine-3.15" # unavailable system package 'llvm-dev'
  "alpine-3.16" # unavailable system package 'llvm-dev'
  "opensuse-15.3" # unavailable system package 'llvm-clang-devel'
  "fedora-42" # The following only have too recent llvm
  "fedora-43"
  "centos-9"
  "centos-10"
  "opensuse-tumbleweed"
]
synopsis: "Virtual package relying on the installation of llvm and clang libraries (<= 19.0.x)"
flags: conf
extra-source "configure.sh" {
  src:
    "https://github.com/ocaml/opam-source-archives/raw/refs/heads/main/patches/conf-libclang/configure-generic.sh.1"
  checksum:
    "sha512=e33c39519a809689d9fd2ef61d174668e3cbeaa04e3188c7363d2c0844497624a137c60b0cb4674e07807b57831781a30b72242d9a672918d5c827bf24ff9ea4"
}
