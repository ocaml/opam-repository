In-process message queues over Lwt with block/fail limits, proper reaction on
thread cancellation, and queues closing.
